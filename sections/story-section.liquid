{{ 'story-section.css' | asset_url | stylesheet_tag }}

<style>
  .story-section {
    margin-top: {{ section.settings.section_margin_bottom }}px;
    padding-top: {{ section.settings.section_padding_top }}px;
    padding-bottom: {{ section.settings.section_padding_bottom }}px;
  }
  @media (max-width: 676px) {
    .story-section {
      margin-top: {{ section.settings.section_margin_bottom }}px;
      padding-top: {{ section.settings.section_padding_top }}px;
      padding-bottom: {{ section.settings.section_padding_bottom }}px;
    }
  }

  .story-section .right button {
    background: {{ section.settings.btn_backgroudColor }};
  }
</style>


<section id="{{ section.id }}" class="story-section">
  <div class="left-right-both">
    <!-- Left Side -->
    <div class="left">
      {% if section.settings.section_video != blank %}
        {{ section.settings.section_video | video_tag: controls: true, autoplay: false, muted: true, loop: true, class: 'story-video' }}
      {% elsif section.settings.section_image != blank %}
        {{ section.settings.section_image | image_url: width: 800 | image_tag: alt: 'Story image' }}
      {% endif %}

    </div>

    <!-- Right Side -->
    <div class="right">
      {% if section.settings.section_heading != blank %}
        <h2>{{ section.settings.section_heading }}</h2>
      {% endif %}

      <div class="text">
        <span>{{ section.settings.Description }}</span>
      </div>

      {% if section.settings.btn_text != blank %}
        <div class="flex-box">
          <button>{{ section.settings.btn_text }}<span>{% render 'small-right' %}</span>
          </button>
        </div>
      {% endif %}

      <!-- Swiper Blocks -->
      <div class="swiper">
        <div class="swiper-wrapper">
          {% for block in section.blocks %}
            <div class="swiper-slide">
              {% if block.settings.Top_Image != blank %}
                {{ block.settings.Top_Image | image_url: width: 100 | image_tag: alt: block.settings.Title }}
              {% endif %}
              {% if block.settings.Title != blank %}
                <h4>{{ block.settings.Title }}</h4>
              {% endif %}
              {% if block.settings.Text != blank %}
                <p>{{ block.settings.Text }}</p>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <!-- ❌ pagination removed -->
        <!-- ✅ custom nav arrows -->
        <div class="swiper-button-prev">
          <!-- left arrow SVG -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="none"
            stroke="black"
            stroke-width="2"><path d="M15 18l-6-6 6-6" /></svg>
        </div>
        <div class="swiper-button-next">
          <!-- right arrow SVG -->
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="none"
            stroke="black"
            stroke-width="2"><path d="M9 6l6 6-6 6" /></svg>
        </div>
      </div>
    </div>
  </div>
  <div class="bottom-div">
    {% if section.settings.Icon_one != blank %}
      {{ section.settings.Icon_one | image_url: width: 130 | image_tag: alt: 'Icon one', class: 'bottom-icon' }}
    {% endif %}
    {% if section.settings.Icon_two != blank %}
      {{ section.settings.Icon_two | image_url: width: 100 | image_tag: alt: 'Icon two', class: 'bottom-icon' }}
    {% endif %}
    {% if section.settings.Icon_three != blank %}
      {{ section.settings.Icon_three | image_url: width: 150 | image_tag: alt: 'Icon three', class: 'bottom-icon' }}
    {% endif %}
  </div>
</section>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const SwiperStory{{- section.id | remove: "--" | remove: "__" | remove: "-" }} = new Swiper(".story-section .swiper", {
      slidesPerView: 1.5,
      spaceBetween: 10,
      loop: true,
      navigation: {
        nextEl: ".story-section .swiper-button-next",
        prevEl: ".story-section .swiper-button-prev",
      },

      breakpoints: {
        0: { slidesPerView: 1.5 },
        768: { slidesPerView: 3 },
        992: { slidesPerView: 2 },
        1200: { slidesPerView: 1.5 },
      },
    });
    const video = document.querySelector(".story-video");
  
    if (video) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              video.play().catch(err => console.log("Autoplay blocked:", err));
            } else {
              video.pause();
            }
          });
        },
        { threshold: 0.5 } // kam se kam 50% visible hona chahiye
      );
  
      observer.observe(video);
    }
  });
</script>

{% schema %}
  {
    "name": "Our story",
    "settings": [
      {
        "type": "header",
        "content": "Spacing - Desktop"
      },
      {
        "type": "range",
        "id": "section_margin_bottom",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "px",
        "label": "Section margin-bottom",
        "default": 0
      },
      {
        "type": "range",
        "id": "section_padding_top",
        "min": 10,
        "max": 60,
        "step": 2,
        "unit": "px",
        "label": "Inner Spacing Top padding",
        "default": 10
      },
      {
        "type": "range",
        "id": "section_padding_bottom",
        "min": 10,
        "max": 60,
        "step": 2,
        "unit": "px",
        "label": "Inner Spacing Bottom padding",
        "default": 10
      }, {
        "type": "header",
        "content": "Spacing - Mobile"
      }, {
        "type": "range",
        "id": "section_margin_bottom_mobile",
        "min": 0,
        "max": 100,
        "step": 5,
        "unit": "px",
        "label": "Section Spacing",
        "default": 0
      }, {
        "type": "range",
        "id": "section_padding_top_mobile",
        "min": 10,
        "max": 60,
        "step": 2,
        "unit": "px",
        "label": "Inner Spacing Top",
        "default": 20
      }, {
        "type": "range",
        "id": "section_padding_bottom_mobile",
        "min": 10,
        "max": 60,
        "step": 2,
        "unit": "px",
        "label": "Inner Spacing Bottom",
        "default": 20
      }, {
        "type": "video",
        "id": "section_video",
        "label": "Upload Video"
      }, {
        "type": "image_picker",
        "id": "section_image",
        "label": "Upload image"
      }, {
        "type": "text",
        "id": "section_heading",
        "label": "Section tag"
      }, {
        "type": "textarea",
        "id": "Description",
        "label": "Description"
      }, {
        "type": "color",
        "id": "btn_backgroudColor",
        "label": "Button backgroud Color"
      }, {
        "type": "text",
        "id": "btn_text",
        "label": "Button text"
      }, {
        "type": "image_picker",
        "id": "Icon_one",
        "label": "Icon one"
      }, {
        "type": "image_picker",
        "id": "Icon_two",
        "label": "Icon two"
      }, {
        "type": "image_picker",
        "id": "Icon_three",
        "label": "Icon three"
      }
    ],
    "blocks": [
      {
        "name": "swiper_block",
        "type": "swiper-block",
        "settings": [
          {
            "type": "image_picker",
            "id": "Top_Image",
            "label": "Image"
          }, {
            "type": "text",
            "id": "Title",
            "label": "Title"
          }, {
            "type": "text",
            "id": "Text",
            "label": "Text"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Our story",
        "settings": {}
      }
    ]
  }
{% endschema %}